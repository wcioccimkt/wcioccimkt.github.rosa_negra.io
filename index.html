<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard - Trabalhos Rosa Negra</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f7fa;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .filters {
      text-align: center;
      margin-bottom: 20px;
    }
    select {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 6px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: #34495e;
      color: white;
    }
    tr:hover {
      background-color: #f9f9f9;
    }
    .entregue { color: green; font-weight: bold; }
    .nao-entregue { color: red; }
    .apresentado { color: #2980b9; font-weight: bold; }
    .nao-apresentado { color: #95a5a6; }

    .charts {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 30px 0;
    }
    .chart-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      flex: 1;
      min-width: 300px;
    }
    .chart-title {
      text-align: center;
      margin-bottom: 10px;
      font-weight: bold;
      color: #2c3e50;
    }
    canvas {
      max-width: 100%;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Dashboard - Trabalhos Rosa Negra</h1>

  <div class="filters">
    <label for="filtroIrmao">Filtrar por Irmão:</label>
    <select id="filtroIrmao" onchange="atualizarDashboard()">
      <option value="todos">Todos</option>
      <option value="Adalberto">Adalberto</option>
      <option value="Nilton">Nilton</option>
      <option value="Mario">Mario</option>
    </select>
  </div>

  <div class="charts">
    <div class="chart-card">
      <div class="chart-title">Progresso por Irmão</div>
      <canvas id="chartProgresso"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-title">Status Geral dos Trabalhos</div>
      <canvas id="chartStatus"></canvas>
    </div>
  </div>

  <table id="tabelaTrabalhos">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Tema</th>
        <th>Entregue</th>
        <th>Apresentação</th>
      </tr>
    </thead>
    <tbody id="corpoTabela"></tbody>
  </table>
</div>

<script>
  // Dados da planilha
  const dadosOriginais = [
    { Nome: "Adalberto", Tema: "Minhas impressões", Entregue: "22/10/2025", Apresentação: "17/11/2025" },
    { Nome: "Adalberto", Tema: "Corda de 81 nós", Entregue: "", Apresentação: "" },
    { Nome: "Adalberto", Tema: "Tronco de solidariedade", Entregue: "", Apresentação: "" },
    { Nome: "Adalberto", Tema: "Teto do Templo", Entregue: "", Apresentação: "" },
    { Nome: "Adalberto", Tema: "Espiritualidade na Maçonaria", Entregue: "", Apresentação: "" },
    { Nome: "Adalberto", Tema: "Questionário", Entregue: "", Apresentação: "" },
    { Nome: "Nilton", Tema: "Minhas impressões", Entregue: "17/02/2025", Apresentação: "17/02/2025" },
    { Nome: "Nilton", Tema: "Corda de 81 nós", Entregue: "02/07/2025", Apresentação: "21/07/2025" },
    { Nome: "Nilton", Tema: "V.I.T.R.I.O.L.", Entregue: "22/08/2025", Apresentação: "22/09/2025" },
    { Nome: "Nilton", Tema: "As 3 colunas de uma Loja ", Entregue: "22/08/2025", Apresentação: "13/10/2025" },
    { Nome: "Nilton", Tema: "A cadeia de União", Entregue: "", Apresentação: "" },
    { Nome: "Nilton", Tema: "Questionário", Entregue: "", Apresentação: "01/12/2025" },
    { Nome: "Mario", Tema: "Minhas impressões", Entregue: "03/03/2025", Apresentação: "03/03/2025" },
    { Nome: "Mario", Tema: "Pedra Bruta", Entregue: "03/03/2025", Apresentação: "03/03/2025" },
    { Nome: "Mario", Tema: "O Painel do Grau de Aprendiz", Entregue: "10/04/2025", Apresentação: "19/05/2025" },
    { Nome: "Mario", Tema: "Câmara de reflexões", Entregue: "07/08/2025", Apresentação: "15/09/2025" },
    { Nome: "Mario", Tema: "Espiritualidade na Maçonaria", Entregue: "24/10/2025", Apresentação: "17/11/2025" },
    { Nome: "Mario", Tema: "Questionário", Entregue: "", Apresentação: "" }
  ];

  let chartProgresso = null;
  let chartStatus = null;

  function formatarData(data) {
    return data ? `<span class="entregue">${data}</span>` : `<span class="nao-entregue">—</span>`;
  }

  function formatarApresentacao(data) {
    return data ? `<span class="apresentado">${data}</span>` : `<span class="nao-apresentado">—</span>`;
  }

  function renderizarTabela(lista) {
    const corpo = document.getElementById("corpoTabela");
    corpo.innerHTML = "";
    lista.forEach(item => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.Nome}</td>
        <td>${item.Tema.trim()}</td>
        <td>${formatarData(item.Entregue)}</td>
        <td>${formatarApresentacao(item.Apresentação)}</td>
      `;
      corpo.appendChild(tr);
    });
  }

  function calcularProgresso(dadosFiltrados) {
    const irmaos = ["Adalberto", "Nilton", "Mario"];
    const progresso = {};
    irmaos.forEach(irmao => {
      const trabalhos = dadosFiltrados.filter(t => t.Nome === irmao);
      const total = trabalhos.length;
      const entregues = trabalhos.filter(t => t.Entregue !== "").length;
      progresso[irmao] = { total, entregues };
    });
    return progresso;
  }

  function atualizarGraficoProgresso(progresso) {
    const ctx = document.getElementById('chartProgresso').getContext('2d');
    const labels = Object.keys(progresso);
    const entregues = labels.map(l => progresso[l].entregues);
    const pendentes = labels.map(l => progresso[l].total - progresso[l].entregues);

    if (chartProgresso) chartProgresso.destroy();

    chartProgresso = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          {
            label: 'Entregues',
            data: entregues,
            backgroundColor: 'rgba(46, 204, 113, 0.7)',
            borderColor: 'rgba(46, 204, 113, 1)',
            borderWidth: 1
          },
          {
            label: 'Pendentes',
            data: pendentes,
            backgroundColor: 'rgba(231, 76, 60, 0.6)',
            borderColor: 'rgba(231, 76, 60, 1)',
            borderWidth: 1
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          title: { display: false }
        },
        scales: {
          x: { stacked: true },
          y: { stacked: true, beginAtZero: true, ticks: { stepSize: 1 } }
        }
      }
    });
  }

  function atualizarGraficoStatus(dadosFiltrados) {
    const totalTrabalhos = dadosFiltrados.length;
    const entregues = dadosFiltrados.filter(t => t.Entregue !== "").length;
    const apresentados = dadosFiltrados.filter(t => t.Apresentação !== "").length;
    const pendentes = totalTrabalhos - entregues;

    const ctx = document.getElementById('chartStatus').getContext('2d');
    if (chartStatus) chartStatus.destroy();

    chartStatus = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Entregues', 'Apresentados', 'Pendentes'],
        datasets: [{
          data: [entregues, apresentados, pendentes],
          backgroundColor: [
            'rgba(46, 204, 113, 0.8)',   // verde
            'rgba(52, 152, 219, 0.8)',   // azul
            'rgba(231, 76, 60, 0.8)'     // vermelho
          ],
          borderWidth: 2,
          borderColor: '#fff'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });
  }

  function atualizarDashboard() {
    const filtro = document.getElementById("filtroIrmao").value;
    let dadosFiltrados = dadosOriginais;

    if (filtro !== "todos") {
      dadosFiltrados = dadosOriginais.filter(item => item.Nome === filtro);
    }

    renderizarTabela(dadosFiltrados);

    // Atualiza gráficos com base em TODOS os irmãos (mesmo com filtro ativo, o gráfico de progresso mostra todos)
    // Se quiser que o gráfico também filtre, troque o argumento abaixo para `dadosFiltrados`
    const progresso = calcularProgresso(dadosOriginais);
    atualizarGraficoProgresso(progresso);
    atualizarGraficoStatus(dadosFiltrados);
  }

  // Inicializa tudo
  atualizarDashboard();
</script>

</body>
</html>
